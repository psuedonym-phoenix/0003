# Changelog

- 2025-02-02: Added configuration, database helper, authentication utilities, and a session-based login page for the admin backend.
- 2025-02-03: Added SQL to create the admin_users table and a CLI helper to seed an admin account.
- 2025-02-04: Redesigned the admin dashboard layout with sidebar navigation, theme toggle, and header actions for enterprise usability.
- 2025-02-05: Split dashboard into reusable header/sidebar/content partials with AJAX-driven navigation to avoid full page reloads.
- 2025-02-05: Moved admin layout styling into a dedicated CSS file for reuse and easier maintenance.
- 2025-02-06: Added order book metadata table definition, UI filter to view purchase orders by selected book, and SQL seeding from existing purchase orders.
- 2025-02-07: Extended order book metadata to include Description 2 and Qty fields and displayed them in the purchase orders view.
- 2025-02-08: Added order book management view with inline editing, update endpoint, and navigation entry.
- 2025-02-09: Split order book management into visible and hidden sections with inline updates that move rows when visibility changes.
- 2025-02-10: Added filtering, sorting, and editable quantity fields to order book management updates.
- 2025-02-11: Fixed inline order book updates so scripts execute after AJAX navigation, restoring Update button behaviour.
- 2025-02-12: Simplified purchase orders view to use only visible order books via dropdown while removing the in-page order book listing.
- 2025-12-05: Rehydrated purchase order partial scripts and delegated the order book change handler to keep reloads working after AJAX swaps.
- 2025-12-06: Added client-side purchase order sorting and supplier filtering with unobtrusive JavaScript.
- 2025-12-07: Added show-all order book option, supplier autocomplete, consistent sortable headers, and default PO Number sorting in purchase orders view.
- 2025-12-08: Added a toggle to include hidden order books in the purchase order filter and labeled hidden items in the dropdown.
- 2025-12-09: Limited purchase order listings to the latest version per PO Number, added pagination capped at 360 orders per page, and carried filters through page navigation.
- 2025-12-10: Hid the Order Sheet column from purchase orders and made the table header stick below the main header when scrolling.
- 2025-12-11: Enabled sorting on PO Number, Supplier, Order Date, Total Amount, and Uploaded columns in purchase orders.
- 2025-12-12: Stabilised the sticky purchase orders table header with scoped offsets so it stays clear of the main header and table rows.
- 2025-12-13: Removed the sticky purchase order header and enabled supplier filtering across all books without pagination when no book is selected.
- 2025-12-14: Clearing supplier filters when switching order books so each selection starts unfiltered.
- 2025-12-15: Added a purchase order detail page with navigation, a View action on purchase orders, and deep links that preserve order book filters when returning.
- 2025-12-16: Moved purchase order Actions before Uploaded in the listing and added type-aware layouts for viewing standard vs transactional purchase orders.
- 2025-12-17: Added a line entry enquiry view to search purchase order line descriptions directly from the sidebar.
- 2025-12-18: Reordered the changelog to append new entries at the bottom to preserve log-style history.
- 2025-12-19: Added PO number, order book, order date, and description filters plus sortable headers to the line entry enquiry table.
- 2025-12-20: Added a compact filter bar under the line entry enquiry header with fuzzy PO, order book, supplier, and description searches plus a clear filters action.
- 2025-12-21: Added supplier suggestions for line enquiry based on the description filter so relevant suppliers appear in a dropdown when selecting the supplier field.
- 2025-12-22: Loaded all suppliers for the line entry enquiry when no filters are set so the supplier field can be pre-populated quickly.
- 2025-12-23: Added Exo as the primary typeface via Google Fonts for a consistent dashboard look.
- 2025-12-24: Purchase order details now load inside the dashboard content area with AJAX-friendly navigation and shared view helpers.
- 2025-12-25: Updated the line entry enquiry View PO action to open purchase orders inside the dashboard instead of a new tab.
- 2025-12-26: Preserved line entry enquiry filters when viewing a purchase order so the back action returns to the same search.
- 2025-12-27: Split multi-word description searches in line entry enquiry so every term must be present, enabling flexible matches across the description text.
- 2025-12-28: Added quantity, unit, and conditional unit price/amount columns to the line entry enquiry results for standard and transactional lines.
- 2025-05-14: Added a dedicated unit price column to the line entry enquiry while retaining the transactional line display rules.
- 2025-05-15: Updated the line entry enquiry amount column to show net price for standard lines and ex-VAT amount for transaction lines.
- 2025-05-16: Corrected the line entry enquiry unit price column to show the unit price for standard lines instead of the net price.
- 2025-05-17: Exposed VAT percentage, exclusive/inclusive totals, and reference on purchase order views and added running totals for line items.
- 2025-05-18: Added a calculated lines total to the purchase order header derived from the displayed line items.
- 2025-05-19: Displayed every purchase order header field from the database alongside the calculated line total in the PO detai
l view.
- 2025-12-06: Updated purchase order view amounts to show VAT alongside exclusive and inclusive totals and ensured VAT data is passed through helpers.
- 2025-12-06: Adjusted purchase order financial summary to show exclusive/inclusive amounts and align total with calculated line values.
- 2025-05-21: Reordered purchase order amounts so exclusive totals precede VAT, pulled the exclusive figure from subtotal, and set total amount to the calculated line sum.
- 2025-05-22: Displayed the VATable flag for each purchase order line with a default tick when VAT applies at the purchase order level.
- 2025-05-23: Calculated Total Amount (Lines) by adding VAT to standard line net prices when the VATable flag allows it.
- 2025-12-06: Added editable purchase order header form with supplier catalogue selection and a secured update endpoint.
- 2025-05-27: Displayed purchase order version counts in the listing to show how many uploads exist per PO number.
- 2025-05-28: Saving a purchase order header now creates a new version with duplicated line items and a supplier dropdown that lists supplier names.
- 2025-05-29: Centralised API database connections through config/db helpers and moved the shared API key into its own file for safer reuse.
- 2025-05-30: Added a shared API bootstrap to load config, database, and API key centrally and updated all root APIs to rely on it.
- 2025-05-31: Relaxed API key resolution to accept legacy field names and headers so Excel uploads no longer hit 403 on purchase order posts.
- 2025-06-01: Trimmed and expanded API key resolution (including Authorization headers) to reduce false 403 errors from Excel clients posting purchase orders.
- 2025-06-02: Pointed the root-level APIs at the shared /app config and API key so database credentials and authentication stay in sync.
- 2025-06-03: Displayed item codes in the line entry enquiry and added an item code filter alongside sorting support.
- 2025-12-08: Enlarged the PO number display in the purchase order header view, hid order book/order sheet fields, and kept the purchase order type fixed.
- 2025-12-08: Updated purchase order header layout to align supplier, order date, and reference fields on one row and kept purchase order type with uploaded metadata side by side.
- 2025-06-04: Organised purchase order financial fields into a single row with equal widths and reduced VAT % label text for better alignment.
- 2025-06-05: Displayed supplier address and contact details on the purchase order view using stored header fields.
- 2025-06-06: Pulled supplier address and contact details from the suppliers table on the purchase order view with purchase order fallbacks.
- 2025-12-08: Refreshed purchase order saves to reload totals with a success notice and replaced the supplier dropdown with a fuzzy text/dropdown picker.

- 2025-12-08: Switched purchase order header amounts to monospaced text inputs and allowed editing of exclusive, inclusive, and VAT fields without numeric type restrictions.
- 2025-12-08: Formatted purchase order amounts with space-separated thousands and highlighted the calculated total when it matches the inclusive amount.
- 2026-07-12: Normalised purchase order header amount parsing to accept formatted numbers when saving edits.
- 2026-07-13: Enabled editable standard purchase order lines with monospaced inputs, live totals, add-line controls, and a secured update endpoint that versions updates.
- 2026-07-14: Rounded purchase order header and calculated line totals to 2 decimals so inclusive amount validation highlights remain stable.
- 2026-07-15: Rounded purchase order totals during validation and running total calculations so 3-decimal inputs no longer cause inclusive versus total mismatches.
- 2026-07-16: Updated document titles to reflect the active dashboard view or purchase order being reviewed.
- 2026-07-17: Forced purchase order header amounts to render with dot decimals in the browser so exclusive, VAT, and inclusive fields no longer show commas as decimal separators.
- 2026-07-18: Tightened standard line item column widths and recalculated net prices plus totals immediately after exiting quantity, unit price, or discount fields.
- 2026-07-19: Adjusted standard line inputs to resize item code/description/pricing fields, allow editable text-only prices, enforce whole-number quantities, and accept user-entered net prices when saving lines.
- 2026-07-20: Moved standard line input sizing classes into admin.css to keep styling centralized.
- 2026-07-21: Namespaced standard line input sizing rules under #poLineTable to align with other line item styles.
- 2026-07-22: Aligned purchase order line headers with editable cells, renamed the quantity heading to QTY, and widened the description column for readability.
- 2026-07-23: Centered the QTY column header and allowed decimal quantities while keeping spinner controls incrementing by one.
- 2026-07-24: Added a UOM catalogue with seeded defaults, fuzzy dropdown suggestions on purchase order lines, and automatic cataloguing of new units when saving edits.
- 2026-07-25: Added delete actions to standard purchase order lines, defaulted new lines to "each" UOM, and aligned UOM header/content positions.
- 2025-12-09: Prevented blank purchase order lines from being sent or saved, enforced line validation, and clarified the save error shown when no usable lines exist.
- 2026-07-26: Surface API error details when saving purchase order lines so alerts show actionable diagnostics.
- 2026-07-27: Saving the purchase order header now also triggers line saves so both updates happen together from the header button.
- 2026-07-28: Refreshed the purchase order ID after line saves so subsequent header updates edit the newest version without conflict errors.
- 2026-07-29: Updated purchase order line input handling so quantity spinner changes immediately recalculate line totals and refresh header exclusive/VAT/inclusive amounts.

- 2025-12-09: Allowed negative unit prices to flow through purchase order line calculations so running totals include credits.
- 2025-12-09: Preserved negative unit prices during purchase order line saves so credit lines are stored instead of reset to zero.
- 2026-07-30: Reused the same purchase order version when saving the header and lines together so header saves no longer create duplicate entries.
- 2026-07-31: Enabled transactional purchase order line editing with deposit-based running totals, recalculated header VAT/total rollups, and monospaced line styling.
